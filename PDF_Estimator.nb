(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    130788,       2973]
NotebookOptionsPosition[    130086,       2949]
NotebookOutlinePosition[    130822,       2974]
CellTagsIndexPosition[    130779,       2971]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"IsReal", "[", "x_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Im", "[", "x", "]"}], "\[Equal]", "0"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetCopulaInfo", "[", "Copula_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Phi]", ",", "\[Psi]", ",", "ZDist", ",", "CopulaName", ",", 
        "\[Theta]"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ZDist", "=", "None"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Copula", "=!=", "\"\<Product\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"CopulaName", ",", "\[Theta]"}], "}"}], "=", "Copula"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Switch", "[", 
           RowBox[{
           "CopulaName", ",", "\[IndentingNewLine]", "\"\<Clayton\>\"", ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Phi]", "[", "\[FormalU]_", "]"}], "=", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 FractionBox["\[FormalU]", "\[Theta]"]}], ")"}], 
               RowBox[{"-", "\[Theta]"}]]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"\[Psi]", "[", "\[FormalU]_", "]"}], "=", 
              RowBox[{"\[Theta]", " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["\[FormalU]", 
                  RowBox[{
                   RowBox[{"-", "1"}], "/", "\[Theta]"}]], "-", "1"}], 
                ")"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"ZDist", "=", 
              RowBox[{"GammaDistribution", "[", 
               RowBox[{"\[Theta]", ",", 
                RowBox[{"1", "/", "\[Theta]"}]}], "]"}]}], ";"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            "\"\<Frank\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Phi]", "[", "\[FormalU]_", "]"}], "=", 
              RowBox[{
               FractionBox["1", 
                RowBox[{"Log", "[", "\[Theta]", "]"}]], 
               RowBox[{"Log", "[", 
                RowBox[{"1", "+", 
                 RowBox[{
                  RowBox[{"Exp", "[", 
                   RowBox[{"-", "\[FormalU]"}], "]"}], " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Exp", "[", 
                    RowBox[{"Log", "[", "\[Theta]", "]"}], "]"}], "-", "1"}], 
                   ")"}]}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"\[Psi]", "[", "\[FormalU]_", "]"}], "=", 
              RowBox[{"-", 
               RowBox[{"Log", "[", " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"Log", "[", "\[Theta]", "]"}], " ", 
                    "\[FormalU]"}], "]"}], " ", "-", " ", "1"}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{"Log", "[", "\[Theta]", "]"}], "]"}], "-", "1"}], 
                  ")"}]}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
            "\"\<GumbelHougaard\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Phi]", "[", "\[FormalU]_", "]"}], "=", 
              RowBox[{"Exp", "[", 
               RowBox[{"-", 
                SuperscriptBox["\[FormalU]", 
                 RowBox[{"1", "/", "\[Theta]"}]]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"\[Psi]", "[", "\[FormalU]_", "]"}], "=", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"-", 
                 RowBox[{"Log", "[", "\[FormalU]", "]"}]}], ")"}], 
               "\[Theta]"]}], ";", "\[IndentingNewLine]", 
             RowBox[{"ZDist", "=", 
              RowBox[{"StableDistribution", "[", 
               RowBox[{"1", ",", 
                RowBox[{"1", "/", "\[Theta]"}], ",", "1", ",", "0", ",", 
                SuperscriptBox[
                 RowBox[{"Cos", "[", 
                  RowBox[{"Pi", " ", "/", 
                   RowBox[{"(", 
                    RowBox[{"2", "\[Theta]"}], ")"}]}], "]"}], "\[Theta]"]}], 
               "]"}]}]}], ",", "\[IndentingNewLine]", "_", ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"\[Phi]", "=", "None"}], ";", 
             RowBox[{"\[Psi]", "=", "None"}]}]}], "\[IndentingNewLine]", 
           "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"\[Phi]", ",", "\[Psi]", ",", "ZDist"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetPDFsCDFs", "[", "Margs_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "Margs", "]"}]}], ",", "LBs", ",", "UBs", ",",
         "PDFs", ",", "CDFs"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Extract", " ", "the", " ", "simple", " ", "form", " ", "for", " ", 
        "the", " ", 
        RowBox[{"pdfs", "/", "cdfs"}], " ", "assuming", " ", "the", " ", 
        "input", " ", "is", " ", "inside", " ", "the", " ", "relevant", " ", 
        RowBox[{"support", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"LBs", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Quantile", "[", 
           RowBox[{
            RowBox[{"Margs", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "0"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], ";", 
       RowBox[{"UBs", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Quantile", "[", 
           RowBox[{
            RowBox[{"Margs", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"PDFs", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Refine", "[", 
           RowBox[{
            RowBox[{"PDF", "[", 
             RowBox[{
              RowBox[{"Margs", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              SubscriptBox["\[FormalX]", "i"]}], "]"}], ",", 
            RowBox[{
             RowBox[{
              SubscriptBox["\[FormalX]", "i"], ">", 
              RowBox[{"LBs", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
             RowBox[{
              SubscriptBox["\[FormalX]", "i"], "<", 
              RowBox[{"UBs", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CDFs", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Refine", "[", 
           RowBox[{
            RowBox[{"CDF", "[", 
             RowBox[{
              RowBox[{"Margs", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              SubscriptBox["\[FormalX]", "i"]}], "]"}], ",", 
            RowBox[{
             RowBox[{
              SubscriptBox["\[FormalX]", "i"], ">", 
              RowBox[{"LBs", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
             RowBox[{
              SubscriptBox["\[FormalX]", "i"], "<", 
              RowBox[{"UBs", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"PDFs", ",", "CDFs"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetJointPDF", "[", 
     RowBox[{"Copula_", ",", "Margs_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "Margs", "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Calculate", " ", "the", " ", "pdf", " ", "of", " ", "X", " ", "using",
         " ", "properties", " ", "of", " ", "Archimedean", " ", "copulas"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\[Phi]", ",", "\[Psi]", ",", "ZDist", ",", "CPDF", ",", "IndPDF"}], 
         "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Phi]", ",", "\[Psi]", ",", "ZDist"}], "}"}], "=", 
          RowBox[{"GetCopulaInfo", "[", "Copula", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CPDF", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"IsIndCopula", "[", "Copula", "]"}], ",", "1", ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{"\[Phi]", "[", "t", "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"t", ",", "n"}], "}"}]}], "]"}], "/.", 
               RowBox[{"{", 
                RowBox[{"t", "\[Rule]", " ", 
                 RowBox[{"Sum", "[", 
                  RowBox[{
                   RowBox[{"\[Psi]", "[", 
                    SubscriptBox["\[FormalU]", "i"], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "}"}]}], ")"}],
              "*", 
             RowBox[{"Product", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"\[Psi]", "'"}], "[", 
                SubscriptBox["\[FormalU]", "i"], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}]}], 
           "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"IndPDF", "=", 
          RowBox[{"Product", "[", 
           RowBox[{"pdf", ",", 
            RowBox[{"{", 
             RowBox[{"pdf", ",", 
              RowBox[{"First", "@", 
               RowBox[{"GetPDFsCDFs", "[", "Margs", "]"}]}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"IndPDF", "*", "CPDF"}]}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DelayMarginals", "[", "Margs_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Margs", "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "0"}], "]"}], "]"}], "===", 
     "LogNormalDistribution"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsIndCopula", "[", "Copula_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{"Copula", "===", " ", "\"\<Product\>\""}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HasMOForm", "[", "Copula_", "]"}], ":=", 
    RowBox[{
     RowBox[{"ListQ", "[", "Copula", "]"}], "&&", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Copula", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", "\"\<Clayton\>\""}],
        "||", 
       RowBox[{
        RowBox[{"Copula", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", " ", 
        "\"\<GumbelHougaard\>\""}]}], ")"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetTestName", "[", 
     RowBox[{"Copula_", ",", "Margs_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", "=", 
        RowBox[{"Length", "[", "Margs", "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"IsIndCopula", "[", "Copula", "]"}], ",", " ", 
         "\"\<Independent\>\"", ",", 
         RowBox[{"ToString", "[", 
          RowBox[{"Copula", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "<>", "\"\<_\>\"", 
       "<>", 
       RowBox[{"StringTrim", "[", 
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"Margs", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "0"}], "]"}], "]"}], "]"}], ",", 
         "\"\<Distribution\>\""}], "]"}], "<>", "\"\<_\>\"", "<>", 
       RowBox[{"ToString", "[", "n", "]"}], "<>", "\"\<_dim\>\""}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SimulateXs", "[", 
     RowBox[{"Copula_", ",", "Margs_", ",", "R_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "Margs", "]"}]}], ",", "\[Phi]", ",", 
        "\[Psi]", ",", "ZDist", ",", "Zs", ",", "Vs", ",", "RVUnifs"}], "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Phi]", ",", "\[Psi]", ",", "ZDist"}], "}"}], "=", 
        RowBox[{"GetCopulaInfo", "[", "Copula", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"If", " ", "we", " ", "have", " ", "Marshal"}], "-", 
          RowBox[{"Olkin", " ", "dependence"}]}], ",", " ", 
         RowBox[{"we", " ", "simulate", " ", "with", " ", "this"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"HasMOForm", "[", "Copula", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<Simulating using Marshall-Olkin form...\>\"", 
           "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Zs", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{"ZDist", ",", "R"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Vs", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"ExponentialDistribution", "[", "1", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"n", ",", "R"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"InverseCDF", "[", 
                RowBox[{
                 RowBox[{"Margs", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", " ", 
                 RowBox[{"\[Phi]", "[", 
                  FractionBox[
                   RowBox[{"Vs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "Zs"], "]"}]}], "]"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "n"}], "}"}]}], "]"}], "]"}], ",", "Zs"}], 
           "}"}]}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "If", " ", "not", " ", "it", " ", "is", " ", "independent", " ", 
           "or", " ", "Frank", " ", 
           RowBox[{"copula", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<Simulating using built-in method\>\"", "]"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"RandomVariate", "[", 
             RowBox[{
              RowBox[{"ProductDistribution", "@@", "Margs"}], ",", "R"}], 
             "]"}], ",", "None"}], "}"}]}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetConditionalProbs", "[", 
     RowBox[{
     "Copula_", ",", "Margs_", ",", "R_", ",", "ss_", ",", "RVs_", ",", "Zs_",
       ",", "FullPDF_", ",", "LeaveOut_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "Margs", "]"}]}], ",", "\[Phi]", ",", 
        "\[Psi]", ",", "ZDist", ",", "PDFs", ",", "CDFs", ",", "Others", ",", 
        "Si", ",", "InSupport"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Phi]", ",", "\[Psi]", ",", "ZDist"}], "}"}], "=", 
        RowBox[{"GetCopulaInfo", "[", "Copula", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"PDFs", ",", "CDFs"}], "}"}], "=", 
        RowBox[{"GetPDFsCDFs", "[", "Margs", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Get", " ", "the", " ", "indices", " ", "which", " ", "are", " ", 
         "conditioned", " ", 
         RowBox[{"upon", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Others", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"Range", "[", "n", "]"}], ",", "LeaveOut"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Sum", " ", "over", " ", "the", " ", "conditional", " ", 
         RowBox[{"RVs", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Si", "=", 
        RowBox[{"Total", "/@", 
         RowBox[{"RVs", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "Others"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Find", " ", "the", " ", "support", " ", "of", " ", 
         RowBox[{"Margs", "[", "LeaveOut", "]"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"LB", ",", "UB"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"LB", "=", 
           RowBox[{"Quantile", "[", 
            RowBox[{
             RowBox[{"Margs", "[", 
              RowBox[{"[", "LeaveOut", "]"}], "]"}], ",", "0"}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"UB", "=", 
           RowBox[{"Quantile", "[", 
            RowBox[{
             RowBox[{"Margs", "[", 
              RowBox[{"[", "LeaveOut", "]"}], "]"}], ",", "1"}], "]"}]}], ";",
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"InSupport", "[", "\[FormalX]_", "]"}], "=", 
           RowBox[{"If", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"UB", "<", "\[Infinity]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"LB", ">", 
                RowBox[{"-", "\[Infinity]"}]}], ",", 
               RowBox[{"Boole", "[", 
                RowBox[{
                 RowBox[{"\[FormalX]", ">", "LB"}], "&&", 
                 RowBox[{"\[FormalX]", "<", "UB"}]}], "]"}], ",", 
               RowBox[{"Boole", "[", 
                RowBox[{"\[FormalX]", "<", "UB"}], "]"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"LB", ">", 
                RowBox[{"-", "\[Infinity]"}]}], ",", 
               RowBox[{"Boole", "[", 
                RowBox[{"\[FormalX]", ">", "LB"}], "]"}], ",", "1"}], "]"}]}],
             "\[IndentingNewLine]", "]"}]}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"If", " ", "we", " ", "have", " ", "the", " ", "Marshal"}], 
          "-", 
          RowBox[{"Olkin", " ", "form"}]}], ",", " ", 
         RowBox[{
         "compute", " ", "the", " ", "extended", " ", "CondMC", " ", 
          "estimator"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"HasMOForm", "[", "Copula", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "CondCPDF", ",", "fLeaveOut", ",", "FLeaveOut", ",", "Pos"}], 
            "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"fLeaveOut", "[", "x_", "]"}], "=", 
             RowBox[{
              RowBox[{"PDFs", "[", 
               RowBox[{"[", "LeaveOut", "]"}], "]"}], "/.", 
              RowBox[{"{", 
               RowBox[{
                SubscriptBox["\[FormalX]", "LeaveOut"], "\[Rule]", "x"}], 
               "}"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"FLeaveOut", "[", "x_", "]"}], "=", 
             RowBox[{
              RowBox[{"CDFs", "[", 
               RowBox[{"[", "LeaveOut", "]"}], "]"}], "/.", 
              RowBox[{"{", 
               RowBox[{
                SubscriptBox["\[FormalX]", "LeaveOut"], "\[Rule]", "x"}], 
               "}"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"Re", "@", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Pos", "=", 
                 RowBox[{"InSupport", "/@", 
                  RowBox[{"(", 
                   RowBox[{"s", " ", "-", " ", "Si"}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"Quiet", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "Zs"}], "*", " ", 
                    RowBox[{
                    RowBox[{"\[Psi]", "'"}], "[", 
                    RowBox[{"FLeaveOut", "[", 
                    RowBox[{"s", " ", "-", " ", "Si"}], "]"}], "]"}], 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", "Zs"}], "   ", 
                    RowBox[{"\[Psi]", "[", 
                    RowBox[{"FLeaveOut", "[", 
                    RowBox[{"s", " ", "-", " ", "Si"}], "]"}], "]"}]}], "]"}], 
                    RowBox[{"fLeaveOut", "[", 
                    RowBox[{"s", " ", "-", " ", "Si"}], "]"}]}], " ", "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Indeterminate", "\[Rule]", " ", "0"}], ",", 
                    RowBox[{"ComplexInfinity", "\[Rule]", " ", "0"}]}], 
                    "}"}]}], ")"}], " ", "*", "Pos"}], "]"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"s", ",", "ss"}], "}"}]}], "]"}]}]}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "CondCPDF", ",", "CondIndPDF", ",", "CondFullPDF", ",", "Pos", 
             ",", "CondToEval", ",", "Repl"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "Find", " ", "the", " ", "conditional", " ", "pdf", " ", "of", 
              " ", 
              SubscriptBox["X", "LeaveOut"]}], " ", "|", " ", 
             SubscriptBox["X", "Others"]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"CondCPDF", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"IsIndCopula", "[", "Copula", "]"}], ",", "1", ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"D", "[", 
                   RowBox[{
                    RowBox[{"\[Phi]", "[", "t", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"t", ",", 
                    RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}], "/.", 
                  "\[IndentingNewLine]", 
                  RowBox[{"{", 
                   RowBox[{"t", "\[Rule]", " ", 
                    RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", 
                    SubscriptBox["\[FormalU]", "i"], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "Others"}], "}"}]}], "]"}]}], "}"}]}], 
                 ")"}], "*", 
                RowBox[{"Product", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"\[Psi]", "'"}], "[", 
                   SubscriptBox["\[FormalU]", "i"], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "Others"}], "}"}]}], "]"}]}]}], 
              "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"DelayMarginals", "[", "Margs", "]"}]}], ",", 
              RowBox[{"CondCPDF", "=", 
               RowBox[{"CondCPDF", "/.", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   SubscriptBox["\[FormalU]", "i"], "\[Rule]", 
                   RowBox[{"CDFs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"CondIndPDF", "=", 
             RowBox[{"Product", "[", 
              RowBox[{
               RowBox[{"PDFs", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "Others"}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"CondFullPDF", "=", 
             RowBox[{"CondIndPDF", "*", "CondCPDF"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"Re", "@", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Pos", "=", 
                 RowBox[{"InSupport", "/@", 
                  RowBox[{"(", 
                   RowBox[{"s", " ", "-", " ", "Si"}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"CondToEval", "=", 
                 FractionBox["FullPDF", "CondFullPDF"]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"Repl", "=", 
                 RowBox[{"Flatten", "@", 
                  RowBox[{"{", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"CondToEval", ",", 
                    SubscriptBox["\[FormalX]", "i"]}], "]"}]}], ",", 
                    RowBox[{
                    SubscriptBox["\[FormalX]", "i"], "\[Rule]", 
                    RowBox[{"RVs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "i"}], "]"}], "]"}]}], ",", 
                    RowBox[{"{", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"CondToEval", ",", 
                    SubscriptBox["\[FormalU]", "i"]}], "]"}]}], ",", 
                    RowBox[{
                    SubscriptBox["\[FormalU]", "i"], "\[Rule]", 
                    RowBox[{"CDF", "[", 
                    RowBox[{
                    RowBox[{"Margs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"RVs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "i"}], "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
                    "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "Others"}], "}"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    SubscriptBox["\[FormalX]", "LeaveOut"], "\[Rule]", 
                    RowBox[{"s", " ", "-", " ", "Si"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"CondToEval", ",", 
                    SubscriptBox["\[FormalU]", "LeaveOut"]}], "]"}]}], ",", 
                    RowBox[{
                    SubscriptBox["\[FormalU]", "LeaveOut"], "\[Rule]", " ", 
                    RowBox[{"CDF", "[", 
                    RowBox[{
                    RowBox[{"Margs", "[", 
                    RowBox[{"[", "LeaveOut", "]"}], "]"}], ",", 
                    RowBox[{"s", " ", "-", " ", "Si"}]}], "]"}]}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
                   "}"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"Quiet", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"CondToEval", "/.", "Repl"}], "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Indeterminate", "\[Rule]", " ", "0"}], ",", 
                    RowBox[{"ComplexInfinity", "\[Rule]", " ", "0"}]}], 
                    "}"}]}], ")"}], "*", "Pos"}], "]"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"s", ",", "ss"}], "}"}]}], "]"}]}]}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CondMCandAKEstimators", "[", 
     RowBox[{
     "Copula_", ",", "Margs_", ",", "R_", ",", "ss_", ",", "RVs_", ",", 
      "Zs_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "Margs", "]"}]}], ",", "FullPDF", ",", 
        "SingleCondIndex", ",", "SingleCondEsts", ",", "SingleCondVars", ",", 
        "SingleCondTime", ",", "CondEsts", ",", "CondVars", ",", "CondTime", 
        ",", "AKEsts", ",", "AKVars", ",", "AKTime", ",", "AllSingleConds", 
        ",", "AllConds", ",", "AllAKs"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SingleCondIndex", "=", "n"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"AllSingleConds", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "ss", "]"}], ",", "R"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"AllConds", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "ss", "]"}], ",", "R"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"AllAKs", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "ss", "]"}], ",", "R"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"SingleCondTime", "=", "0"}], ";", 
       RowBox[{"CondTime", "=", "0"}], ";", 
       RowBox[{"AKTime", "=", "0"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"FullPDF", "=", 
        RowBox[{"GetJointPDF", "[", 
         RowBox[{"Copula", ",", "Margs"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Do", " ", "each", " ", "of", " ", "the", " ", "n", " ", "versions", 
         " ", "of", " ", "these", " ", "estimators"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"CondProbs", ",", "CondProbTime"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"R", ">", 
                SuperscriptBox["10", "5"]}], ",", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<Starting CondMC+AK step \>\"", ",", " ", "LeaveOut", 
                 ",", "\"\< of \>\"", ",", " ", "n"}], "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"CondProbTime", "=", 
              RowBox[{"First", "@", 
               RowBox[{"Timing", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"CondProbs", "=", 
                  RowBox[{"GetConditionalProbs", "[", 
                   RowBox[{
                   "Copula", ",", "Margs", ",", "R", ",", "ss", ",", "RVs", 
                    ",", "Zs", ",", "FullPDF", ",", "LeaveOut"}], "]"}]}], 
                 ";"}], "\[IndentingNewLine]", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AllConds", "+=", " ", 
              RowBox[{
               FractionBox["1", "n"], "CondProbs"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CondTime", "+=", "CondProbTime"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
               "If", " ", "this", " ", "is", " ", "the", " ", "special", " ", 
                "dimension", " ", "for", " ", 
                RowBox[{"the", " ", "'"}], 
                RowBox[{"single", "'"}], " ", "CondMC", " ", "estimator"}], 
               ",", " ", 
               RowBox[{"store", " ", "it", " ", 
                RowBox[{"separately", "."}]}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"LeaveOut", "\[Equal]", "SingleCondIndex"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"AllSingleConds", " ", "=", " ", "CondProbs"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"SingleCondTime", "+=", "CondProbTime"}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"Compute", " ", "the", " ", "Asmussen"}], "-", 
               RowBox[{
               "Kroese", " ", "density", " ", "estimates", " ", "by", " ", 
                "reusing", " ", "the", " ", "previously", " ", "calculated", 
                " ", "conditional", " ", 
                RowBox[{"densities", "."}]}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"Block", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Others", ",", "Mi", ",", "Si"}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"AKTime", "+=", 
                 RowBox[{"CondProbTime", "+", 
                  RowBox[{"First", "@", 
                   RowBox[{"Timing", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Others", "=", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{
                    RowBox[{"Range", "[", "n", "]"}], ",", "LeaveOut"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Calculate", " ", "the", " ", "maxima"}], " ", 
                    "&"}], " ", "sums", " ", "of", " ", "the", " ", 
                    SubscriptBox["X", "Others"], " ", "vectors"}], " ", 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Mi", ",", "Si"}], "}"}], "=", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Max", "[", "#", "]"}], ",", 
                    RowBox[{"Total", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
                    RowBox[{"RVs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "Others"}], "]"}], "]"}]}], ")"}], 
                    "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{"AllAKs", "+=", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CondProbs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], " ", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Boole", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Mi", "[", 
                    RowBox[{"[", "r", "]"}], "]"}], "<", " ", 
                    RowBox[{
                    RowBox[{"ss", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "-", 
                    RowBox[{"Si", "[", 
                    RowBox[{"[", "r", "]"}], "]"}]}]}], ")"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"r", ",", "R"}], "}"}]}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "ss", "]"}]}], "}"}]}], "]"}]}], 
                    ";"}], "\[IndentingNewLine]", "]"}]}]}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",",
             " ", 
            RowBox[{"{", 
             RowBox[{"LeaveOut", ",", "n"}], "}"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Calculate", " ", "the", " ", 
         RowBox[{"final", "/", "combined"}], " ", "estimates", " ", "and", 
         " ", "their", " ", 
         RowBox[{"variances", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"SingleCondTime", "+=", 
        RowBox[{"First", "@", 
         RowBox[{"Timing", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"SingleCondEsts", ",", "SingleCondVars"}], "}"}], "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Mean", "[", "#", "]"}], ",", 
                 RowBox[{"Variance", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
              "AllSingleConds"}], ")"}], "\[Transpose]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CondTime", "+=", 
        RowBox[{"First", "@", 
         RowBox[{"Timing", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"CondEsts", ",", "CondVars"}], "}"}], "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Mean", "[", "#", "]"}], ",", 
                 RowBox[{"Variance", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
              "AllConds"}], ")"}], "\[Transpose]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AKTime", "+=", 
        RowBox[{"First", "@", 
         RowBox[{"Timing", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"AKEsts", ",", "AKVars"}], "}"}], "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Mean", "[", "#", "]"}], ",", 
                 RowBox[{"Variance", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
              "AllAKs"}], ")"}], "\[Transpose]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
        "SingleCondEsts", ",", "SingleCondVars", ",", "SingleCondTime", ",", 
         "CondEsts", ",", "CondVars", ",", "CondTime", ",", "AKEsts", ",", 
         "AKVars", ",", "AKTime"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PushoutEstimator", "[", 
     RowBox[{"Copula_", ",", "Margs_", ",", "R_", ",", "ss_", ",", "RVs_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "Margs", "]"}]}], ",", "PDFs", ",", "CDFs", 
        ",", "FullPDF", ",", "Grads", ",", "OurEsts"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Perform", " ", "the", " ", "push"}], "-", 
        RowBox[{"out", " ", "estimator"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", "\"\<Starting push-out estimator\>\"", "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"PDFs", ",", "CDFs"}], "}"}], "=", 
        RowBox[{"GetPDFsCDFs", "[", "Margs", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Sometimes", " ", "the", " ", "repeated", " ", "CDF", " ", 
          "evaluation", " ", "is", " ", "very", " ", "slow"}], ",", " ", 
         RowBox[{
         "so", " ", "we", " ", "do", " ", "a", " ", "trick", " ", "to", " ", 
          "avoid", " ", "repeated", " ", "calls", " ", "to", " ", 
          RowBox[{"this", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FullPDF", "=", 
        RowBox[{
         RowBox[{"GetJointPDF", "[", 
          RowBox[{"Copula", ",", "Margs"}], "]"}], "/.", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"DelayMarginals", "[", "Margs", "]"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              SubscriptBox["\[FormalU]", "i"], "\[Rule]", " ", 
              RowBox[{
               SubscriptBox["\[FormalU]", "i"], "[", 
               SubscriptBox["\[FormalX]", "i"], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              SubscriptBox["\[FormalU]", "i"], "\[Rule]", 
              RowBox[{"CDFs", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Calculate", " ", "the", " ", "gradient", " ", "of", " ", "the", " ", 
         "log", " ", "density", " ", "at", " ", "each", " ", "replicate", " ", 
         RowBox[{"point", "."}]}], "  ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Derivs", ",", "Repl", ",", "M"}], "}"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Derivs", "=", 
           RowBox[{"Grad", "[", 
            RowBox[{
             RowBox[{"Log", "[", "FullPDF", "]"}], ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               SubscriptBox["\[FormalX]", "i"], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Repl", "=", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"Derivs", ",", 
                    SubscriptBox["\[FormalU]", "i"]}], "]"}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    SubscriptBox["\[FormalU]", "i"], "[", 
                    SubscriptBox["\[FormalX]", "i"], "]"}], "\[Rule]", 
                    RowBox[{"CDF", "[", 
                    RowBox[{
                    RowBox[{"Margs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"RVs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "i"}], "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    SubscriptBox["\[FormalU]", "i"], "'"}], "[", 
                    SubscriptBox["\[FormalX]", "i"], "]"}], "\[Rule]", 
                    RowBox[{"PDF", "[", 
                    RowBox[{
                    RowBox[{"Margs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"RVs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "i"}], "]"}], "]"}]}], "]"}]}]}], 
                    "}"}], ",", 
                   RowBox[{"{", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"Derivs", ",", 
                    SubscriptBox["\[FormalX]", "i"]}], "]"}]}], ",", 
                   RowBox[{
                    SubscriptBox["\[FormalX]", "i"], "\[Rule]", 
                    RowBox[{"RVs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "i"}], "]"}], "]"}]}], ",", 
                   RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "n"}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "This", " ", "line", " ", "literally", " ", "breaks", " ", "when",
              " ", "one", " ", "marginal", " ", "is", " ", "the", " ", 
             "exponential", " ", 
             RowBox[{"distribution", " ", "--"}], " ", 
             RowBox[{"that", "'"}], "s", " ", "because", " ", "the", " ", 
             "derivative", " ", "is", " ", "constant", " ", "in", " ", "that",
              " ", "direction"}], ",", " ", 
            RowBox[{
            "so", " ", "once", " ", "the", " ", "replacement", " ", 
             "\"\<Repl\>\"", " ", "has", " ", "occurred", " ", "then", " ", 
             "the", " ", 
             RowBox[{"resulting", " ", "'"}], 
             RowBox[{"thing", "'"}], " ", 
             RowBox[{"isn", "'"}], "t", " ", "a", " ", "proper", " ", 
             RowBox[{"matrix", ".", " ", 
              RowBox[{"It", "'"}]}], "s", " ", "too", " ", "ugly", " ", "to", 
             " ", "fix", " ", "this", " ", 
             RowBox[{"now", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"M", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Derivs", "/.", "Repl"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Grads", "=", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"RVs", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ".", 
               RowBox[{"M", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "R"}], "}"}]}], "]"}], "+", "n"}]}], ";"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Construct", " ", "the", " ", "two", " ", "versions", " ", "of", " ",
           "the", " ", "estimator"}], ",", " ", 
         RowBox[{
         "then", " ", "make", " ", "the", " ", "approximately", " ", 
          "optimal", " ", "mixture", " ", "of", " ", 
          RowBox[{"them", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "Sums", ",", "Inds", ",", "Lefts", ",", "Rights", ",", "PilotSize", 
           ",", "CC", ",", "p"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Sums", "=", 
           RowBox[{"Total", "/@", "RVs"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"OurEsts", "=", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Inds", "=", " ", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Boole", "[", 
                  RowBox[{"Sr", " ", "\[LessEqual]", " ", "s"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"Sr", ",", "Sums"}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Lefts", "=", " ", 
               RowBox[{"Grads", " ", "*", 
                RowBox[{"Inds", "/", "s"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Rights", "=", 
               RowBox[{
                RowBox[{"-", " ", "Grads"}], " ", "*", " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", "Inds"}], ")"}], "/", "s"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"PilotSize", "=", 
               RowBox[{"Max", "[", 
                RowBox[{"3", ",", 
                 RowBox[{"Ceiling", "[", 
                  RowBox[{"0.05", "*", "R"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"CC", "=", 
               RowBox[{"Covariance", "[", 
                RowBox[{"Transpose", "@", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Lefts", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", "PilotSize"}], "]"}], "]"}], ",", 
                   RowBox[{"Rights", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", "PilotSize"}], "]"}], "]"}]}], "}"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"p", "=", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"CC", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", 
                  RowBox[{"CC", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"CC", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"CC", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "-", 
                  RowBox[{"2", 
                   RowBox[{"CC", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], ")"}]}]}], ";",
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"p", "*", 
                RowBox[{"Lefts", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"PilotSize", "+", "1"}], ";;"}], "]"}], "]"}]}], 
               "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", "p"}], ")"}], 
                RowBox[{"Rights", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"PilotSize", "+", "1"}], ";;"}], "]"}], 
                 "]"}]}]}]}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"s", ",", "ss"}], "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Mean", "[", "#", "]"}], ",", 
             RowBox[{"Variance", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
          "OurEsts"}], ")"}], "\[Transpose]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"http", ":"}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "69771"}], "/", "implement"}], "-", "the", "-", 
     "bisection", "-", "algorithm", "-", "elegantly", "-", "and", "-", 
     "easily"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"biSection", "[", 
      RowBox[{"func_", ",", 
       RowBox[{"{", 
        RowBox[{"a_", ",", "b_"}], "}"}], ",", 
       RowBox[{"eps_", "?", "Positive"}]}], "]"}], "/;", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"a", "<", "b"}], "&&", 
       RowBox[{
        RowBox[{
         RowBox[{"func", "[", "a", "]"}], 
         RowBox[{"func", "[", "b", "]"}]}], "<", "0"}]}], ")"}]}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"c", "=", "a"}], ",", 
        RowBox[{"d", "=", "b"}]}], "}"}], ",", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"test", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"func", "[", "a", "]"}], ">", "0"}], ",", "Greater", ",",
             "Less"}], "]"}]}], "}"}], ",", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"d", "-", "c"}], ">", "eps"}], ",", 
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"e", "=", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"c", "+", "d"}], ")"}], "/", "2"}]}], "}"}], ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"test", "[", 
                RowBox[{
                 RowBox[{"func", "[", "e", "]"}], ",", "0"}], "]"}], ",", 
               RowBox[{"c", "=", "e"}], ",", 
               RowBox[{"d", "=", "e"}]}], "]"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"c", ",", "d"}], "}"}]}]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"VectorisedNewtonsMethod", "[", 
     RowBox[{"fn_", ",", "targets_", ",", "niter_", ",", 
      RowBox[{"xstarts_:", "None"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"update", ",", "xs", ",", "diffs"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"xs", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"xstarts", "===", "None"}], ",", 
          RowBox[{"1.0", "*", "targets"}], ",", " ", "xstarts"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"update", "[", 
         RowBox[{"x_", ",", "t_"}], "]"}], "=", 
        RowBox[{"FullSimplify", "[", 
         FractionBox[
          RowBox[{
           RowBox[{"fn", "[", "x", "]"}], "-", "t"}], 
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"fn", "[", "x", "]"}], ",", "x"}], "]"}]], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"xs", "=", 
           RowBox[{
            RowBox[{"xs", " ", "-", 
             RowBox[{"update", "[", 
              RowBox[{"xs", ",", "targets"}], "]"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Underflow", "[", "]"}], "\[Rule]", " ", 
              "Indeterminate"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "niter"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "xs"}]}], "]"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"VectorisedHalleysMethod", "[", 
     RowBox[{"fn_", ",", "targets_", ",", "niter_", ",", 
      RowBox[{"xstarts_:", "None"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "loggradf", ",", "logupdate", ",", "update", ",", "xs", ",", "diffs"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"xs", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"xstarts", "===", "None"}], ",", 
          RowBox[{"1.0", "*", "targets"}], ",", " ", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"xstarts", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "=!=", " ", "Indeterminate"}],
               ",", 
              RowBox[{"xstarts", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"1.0", "*", 
               RowBox[{"targets", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "xstarts", "]"}]}], "}"}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"update", "[", 
         RowBox[{"x_", ",", "t_"}], "]"}], "=", 
        RowBox[{"FullSimplify", "[", 
         RowBox[{
          FractionBox[
           RowBox[{
            RowBox[{"fn", "[", "x", "]"}], "-", "t"}], 
           RowBox[{
            RowBox[{"fn", "'"}], "[", "x", "]"}]], 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            FractionBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"fn", "[", "x", "]"}], "-", "t"}], ")"}], 
              RowBox[{
               RowBox[{"fn", "''"}], "[", "x", "]"}]}], 
             RowBox[{"2", " ", 
              SuperscriptBox[
               RowBox[{
                RowBox[{"fn", "'"}], "[", "x", "]"}], "2"]}]]}], ")"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"xs", "=", 
           RowBox[{
            RowBox[{"xs", " ", "-", 
             RowBox[{"update", "[", 
              RowBox[{"xs", ",", "targets"}], "]"}]}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Underflow", "[", "]"}], "\[Rule]", " ", 
              "Indeterminate"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "niter"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "xs"}]}], "]"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SimulateConditionallyFromG", "[", 
     RowBox[{
     "Copula_", ",", "Margs_", ",", "R_", ",", "s_", ",", "Uniforms_", ",", 
      RowBox[{"PreviousInverses_:", "None"}], ",", 
      RowBox[{"Verbose_:", "False"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "Margs", "]"}]}], ",", "cdf", ",", "Us", ",", 
        "Ys", ",", "\[Phi]", ",", "\[Psi]", ",", "YPartialSums", ",", "LRs", 
        ",", "Inverses", ",", "SumPsis", ",", "D\[Phi]JMinus1", ",", 
        "D\[Phi]JMinus1AtSumPsis", ",", "maxOutputDesired", ",", "Invs", ",", 
        RowBox[{"InvTime", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Us", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"None", ",", 
          RowBox[{"{", 
           RowBox[{"R", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Ys", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"None", ",", 
          RowBox[{"{", 
           RowBox[{"R", ",", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Phi]", ",", "\[Psi]"}], "}"}], "=", 
        RowBox[{
         RowBox[{"GetCopulaInfo", "[", "Copula", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"IsIndCopula", "[", "Copula", "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"D\[Phi]JMinus1", "[", "\[FormalX]_", "]"}], "=", 
          RowBox[{"\[Phi]", "[", "\[FormalX]", "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Us", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"Uniforms", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], "*", 
         RowBox[{"CDF", "[", 
          RowBox[{
           RowBox[{"Margs", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "s"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Ys", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"InverseCDF", "[", 
          RowBox[{
           RowBox[{"Margs", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"Us", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "]"}], "/", "s"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"YPartialSums", " ", "=", " ", 
        RowBox[{"Ys", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"LRs", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"CDF", "[", 
           RowBox[{
            RowBox[{"Margs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "s"}], "]"}], ",", "R"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Inverses", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"Verbose", ",", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Smallest leftover val is \>\"", ",", 
              RowBox[{"1", "-", 
               RowBox[{"Max", "[", "YPartialSums", "]"}]}]}], "]"}]}], "]"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"maxOutputDesired", "=", 
           RowBox[{"CDF", "[", 
            RowBox[{
             RowBox[{"Margs", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", 
             RowBox[{"s", "*", 
              RowBox[{"(", 
               RowBox[{"1", "-", "YPartialSums"}], ")"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", "maxInputRequired", "}"}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"maxInputRequired", "=", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"IsIndCopula", "[", "Copula", "]"}], ",", 
                "\[IndentingNewLine]", "maxOutputDesired", ",", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"D\[Phi]JMinus1", "[", "x_", "]"}], "=", 
                  RowBox[{"D", "[", 
                   RowBox[{
                    RowBox[{"D\[Phi]JMinus1", "[", "x", "]"}], ",", "x"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"SumPsis", "=", 
                  RowBox[{
                   RowBox[{"Total", "/@", 
                    RowBox[{"(", 
                    RowBox[{"\[Psi]", "[", 
                    RowBox[{"Us", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", 
                    RowBox[{"1", ";;", 
                    RowBox[{"j", "-", "1"}]}]}], "]"}], "]"}], "]"}], ")"}]}],
                    "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Overflow", "[", "]"}], "\[Rule]", " ", 
                    "Indeterminate"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"D\[Phi]JMinus1AtSumPsis", "=", 
                  RowBox[{"D\[Phi]JMinus1", "[", "SumPsis", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"D\[Phi]JMinus1", "[", 
                   RowBox[{"SumPsis", " ", "+", " ", 
                    RowBox[{"\[Psi]", "[", "maxOutputDesired", "]"}]}], "]"}],
                   "/", "D\[Phi]JMinus1AtSumPsis"}]}]}], 
               "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"LRs", "=", 
              RowBox[{"LRs", "*", "maxInputRequired"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Us", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "j"}], "]"}], "]"}], "=", 
              RowBox[{
               RowBox[{"Uniforms", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "j"}], "]"}], "]"}], "*", 
               "maxInputRequired"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"IsIndCopula", "[", "Copula", "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"InvTime", "=", 
              RowBox[{"InvTime", "+", 
               RowBox[{"First", "@", 
                RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Block", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"InvArgs", ",", "order", ",", 
                    RowBox[{"prev", "=", "0"}]}], "}"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"InvArgs", "=", 
                    RowBox[{
                    RowBox[{"Us", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "j"}], "]"}], "]"}], " ", "*", 
                    "D\[Phi]JMinus1AtSumPsis"}]}], ";", "\[IndentingNewLine]",
                     "\[IndentingNewLine]", 
                    RowBox[{"Invs", "=", 
                    RowBox[{"VectorisedHalleysMethod", "[", 
                    RowBox[{"D\[Phi]JMinus1", ",", "InvArgs", ",", 
                    SuperscriptBox["10", "4"], ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"PreviousInverses", "=!=", " ", "None"}], ",", 
                    RowBox[{"PreviousInverses", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", "-", "1"}], "]"}], "]"}], ",", "None"}], 
                    "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"Invs", "=", 
                    RowBox[{"Invs", "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Overflow", "[", "]"}], "\[Rule]", " ", 
                    "Indeterminate"}], ",", 
                    RowBox[{
                    RowBox[{"Underflow", "[", "]"}], "\[Rule]", " ", 
                    "Indeterminate"}]}], "}"}]}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"Inverses", ",", "Invs"}], "]"}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Us", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "j"}], "]"}], "]"}], "=", 
                    RowBox[{"\[Phi]", "[", 
                    RowBox[{"Invs", " ", "-", "  ", "SumPsis"}], "]"}]}], ";",
                     "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"LRs", "=", 
                    RowBox[{"LRs", "*", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"IsReal", "[", 
                    RowBox[{"Us", "[", 
                    RowBox[{"[", 
                    RowBox[{"r", ",", "j"}], "]"}], "]"}], "]"}], ",", "1", 
                    ",", "Indeterminate"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"r", ",", "R"}], "}"}]}], "]"}]}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"AllTrue", "[", 
                    RowBox[{
                    RowBox[{"Us", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "j"}], "]"}], "]"}], ",", " ", 
                    "IsReal"}], "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "\"\<This shouldn't be complex valued \>\"", " ", "<>", 
                    " ", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"Us", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "j"}], "]"}], "]"}], "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]",
                  "]"}]}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Ys", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"InverseCDF", "[", 
             RowBox[{
              RowBox[{"Margs", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", 
              RowBox[{"Us", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "j"}], "]"}], "]"}]}], "]"}], "/", "s"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"YPartialSums", " ", "=", 
           RowBox[{"YPartialSums", "+", " ", 
            RowBox[{"Ys", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "j"}], "]"}], "]"}]}]}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "2", ",", "n"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Verbose", "&&", 
          RowBox[{"!", 
           RowBox[{"IsIndCopula", "[", "Copula", "]"}]}]}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Inversion time: \>\"", ",", " ", "InvTime"}], "]"}]}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"Ys", ",", "LRs", ",", "Inverses"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PushoutISEstimator", "[", 
     RowBox[{"Copula_", ",", "Margs_", ",", "R_", ",", "ss_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "Margs", "]"}]}], ",", "PDFs", ",", "CDFs", 
        ",", "FullPDF", ",", "Derivs", ",", "OurISEsts"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Perform", " ", "the", " ", "push"}], "-", "out", " ", "+", 
        " ", 
        RowBox[{"IS", " ", "estimator"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "Print", "[", "\"\<Starting push-out + IS estimator\>\"", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"PDFs", ",", "CDFs"}], "}"}], "=", 
        RowBox[{"GetPDFsCDFs", "[", "Margs", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Sometimes", " ", "the", " ", "repeated", " ", "CDF", " ", 
          "evaluation", " ", "is", " ", "very", " ", "slow"}], ",", " ", 
         RowBox[{
         "so", " ", "we", " ", "do", " ", "a", " ", "trick", " ", "to", " ", 
          "avoid", " ", "repeated", " ", "calls", " ", "to", " ", 
          RowBox[{"this", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FullPDF", "=", 
        RowBox[{
         RowBox[{"GetJointPDF", "[", 
          RowBox[{"Copula", ",", "Margs"}], "]"}], "/.", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"DelayMarginals", "[", "Margs", "]"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              SubscriptBox["\[FormalU]", "i"], "\[Rule]", " ", 
              RowBox[{
               SubscriptBox["\[FormalU]", "i"], "[", 
               SubscriptBox["\[FormalX]", "i"], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              SubscriptBox["\[FormalU]", "i"], "\[Rule]", 
              RowBox[{"CDFs", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Calculate", " ", "the", " ", "gradient", " ", "of", " ", "the", " ", 
         "log", " ", 
         RowBox[{"density", "."}]}], "  ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Derivs", "=", 
        RowBox[{"Grad", "[", 
         RowBox[{
          RowBox[{"Log", "[", "FullPDF", "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            SubscriptBox["\[FormalX]", "i"], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "RVUnifs", ",", "PreviousInverses", ",", "Ys", ",", "LRs", ",", 
           "Xs", ",", "Repl", ",", "M", ",", "Grads"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Get", " ", "some", " ", "uniforms", " ", "using", " ", "low", " ", 
           "discrepency", " ", 
           RowBox[{"sequence", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"BlockRandom", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"SeedRandom", "[", 
             RowBox[{"1", ",", 
              RowBox[{"Method", " ", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"\"\<MKL\>\"", ",", 
                 RowBox[{"Method", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"\"\<Sobol\>\"", ",", 
                    RowBox[{"\"\<Dimension\>\"", "\[Rule]", "n"}]}], 
                   "}"}]}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"SeedRandom", "[", "1", "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"RVUnifs", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{
               RowBox[{"UniformDistribution", "[", "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"RforIS", "[", "R", "]"}], ",", "n"}], "}"}]}], 
              RowBox[{"(*", 
               RowBox[{",", 
                RowBox[{"WorkingPrecision", "\[Rule]", "20"}]}], "*)"}], 
              "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"PreviousInverses", "=", "None"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"OurISEsts", "=", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
                RowBox[{"N", "[", "s", "]"}], ",", "\"\< of \>\"", ",", " ", 
                RowBox[{"Max", "[", "ss", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Use", " ", "these", " ", "uniforms", " ", "to", " ", 
                "generate", " ", "from", " ", "the", " ", "new", " ", "IS", 
                " ", 
                RowBox[{"density", "."}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Ys", ",", "LRs", ",", "PreviousInverses"}], "}"}], 
               "=", 
               RowBox[{"SimulateConditionallyFromG", "[", 
                RowBox[{"Copula", ",", " ", "Margs", ",", 
                 RowBox[{"RforIS", "[", "R", "]"}], ",", "s", ",", "RVUnifs", 
                 ",", "PreviousInverses"}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Xs", "=", 
               RowBox[{"Ys", "*", "s"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Repl", "=", 
               RowBox[{"Flatten", "@", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"Derivs", ",", 
                    SubscriptBox["\[FormalU]", "i"]}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    SubscriptBox["\[FormalU]", "i"], "[", 
                    SubscriptBox["\[FormalX]", "i"], "]"}], "\[Rule]", 
                    RowBox[{"CDF", "[", 
                    RowBox[{
                    RowBox[{"Margs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"Xs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "i"}], "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    SubscriptBox["\[FormalU]", "i"], "'"}], "[", 
                    SubscriptBox["\[FormalX]", "i"], "]"}], "\[Rule]", 
                    RowBox[{"PDF", "[", 
                    RowBox[{
                    RowBox[{"Margs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"Xs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "i"}], "]"}], "]"}]}], "]"}]}]}], 
                    "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"Derivs", ",", 
                    SubscriptBox["\[FormalX]", "i"]}], "]"}]}], ",", 
                    RowBox[{
                    SubscriptBox["\[FormalX]", "i"], "\[Rule]", 
                    RowBox[{"Xs", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "i"}], "]"}], "]"}]}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
                    "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "n"}], "}"}]}], "]"}], 
                 "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]",
               "\[IndentingNewLine]", 
              RowBox[{"M", "=", 
               RowBox[{"Transpose", "[", 
                RowBox[{"Derivs", "/.", "Repl"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Grads", "=", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Xs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ".", 
                   RowBox[{"M", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"RforIS", "[", "R", "]"}]}], "}"}]}], "]"}], "+", 
                "n"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"Grads", " ", "/", "s"}], ")"}], "*", "LRs"}]}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"s", ",", "ss"}], "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Mean", "[", "#", "]"}], ",", 
             RowBox[{"Variance", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{"OurISEsts", ",", "Indeterminate"}], "]"}]}], ")"}], 
        "\[Transpose]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PrintResults", "[", 
     RowBox[{
     "EstNames_", ",", "AllEsts_", ",", "AllStdDevs_", ",", "AllTimes_", ",", 
      "AllREs_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Estimates", "."}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", "\"\<Estimates:\>\"", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\\t* \>\"", ",", " ", 
           RowBox[{"EstNames", "[", 
            RowBox[{"[", "e", "]"}], "]"}], ",", "\"\<: \>\"", ",", " ", 
           RowBox[{"AllEsts", "[", 
            RowBox[{"[", "e", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"e", ",", 
           RowBox[{"Length", "[", "AllEsts", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Standard", " ", 
         RowBox[{"deviations", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "\"\<Standard deviations:\>\"", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\\t* \>\"", ",", " ", 
           RowBox[{"EstNames", "[", 
            RowBox[{"[", "e", "]"}], "]"}], ",", "\"\<: \>\"", ",", " ", 
           RowBox[{"AllStdDevs", "[", 
            RowBox[{"[", "e", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"e", ",", 
           RowBox[{"Length", "[", "AllStdDevs", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Computation", " ", 
         RowBox[{"times", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "\"\<Times:\>\"", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\\t* \>\"", ",", " ", 
           RowBox[{"EstNames", "[", 
            RowBox[{"[", "e", "]"}], "]"}], ",", "\"\<: \>\"", ",", " ", 
           RowBox[{"AllTimes", "[", 
            RowBox[{"[", "e", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"e", ",", 
           RowBox[{"Length", "[", "AllTimes", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Estimated", " ", "relative", " ", 
         RowBox[{"errors", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "\"\<Estimated Relative errors:\>\"", "]"}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\\t* \>\"", ",", " ", 
           RowBox[{"EstNames", "[", 
            RowBox[{"[", "e", "]"}], "]"}], ",", "\"\<: \>\"", ",", " ", 
           RowBox[{"AllREs", "[", 
            RowBox[{"[", "e", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"e", ",", 
           RowBox[{"Length", "[", "AllREs", "]"}]}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlotResults", "[", 
     RowBox[{
     "TestName_", ",", "ss_", ",", "EstNames_", ",", "AllEsts_", ",", 
      "AllStdDevs_", ",", "AllTimes_", ",", "AllREs_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "WithS", ",", "Colours", ",", "EstimatesPlotSmall", ",", 
        "EstimatesPlot", ",", "StdDevsPlotSmall", ",", "SqrtWNRVPlotSmall", 
        ",", "SqrtWNRVPlot", ",", "CombinedPlot"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"WithS", "[", "Data_", "]"}], ":=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{"ss", ",", "Data"}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Colours", "=", 
        RowBox[{
         RowBox[{"Lookup", "[", "\"\<DefaultPlotStyle\>\"", "]"}], "@", 
         RowBox[{
          RowBox[{"Lookup", "[", "Method", "]"}], "@", 
          RowBox[{"Charting`ResolvePlotTheme", "[", 
           RowBox[{"Automatic", ",", "Plot"}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"EstimatesPlotSmall", "=", "\[IndentingNewLine]", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{"WithS", ",", "AllEsts"}], "]"}], ",", 
          RowBox[{"Joined", "\[Rule]", "True"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"250", ",", "125"}], "}"}]}], ",", 
          RowBox[{"AspectRatio", "\[Rule]", 
           RowBox[{"1", "/", "2"}]}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"Thickness", "[", "0.012", "]"}]}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"\"\<x\>\"", ",", "\"\<Estimates\>\""}], "}"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"EstimatesPlot", "=", "\[IndentingNewLine]", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{"WithS", ",", "AllEsts"}], "]"}], ",", 
          RowBox[{"Joined", "\[Rule]", "True"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"500", ",", "125"}], "}"}]}], ",", 
          RowBox[{"AspectRatio", "\[Rule]", "0.21"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"Thickness", "[", "0.006", "]"}]}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"\"\<x\>\"", ",", "\"\<Estimates\>\""}], "}"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"StdDevsPlotSmall", "=", "\[IndentingNewLine]", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{"WithS", ",", "AllStdDevs"}], "]"}], ",", 
          RowBox[{"Joined", "\[Rule]", "True"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"Thickness", "[", "0.012", "]"}]}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"\"\<x\>\"", ",", "\"\<Standard Deviation\>\""}], "}"}]}],
           ",", 
          RowBox[{"ImageSize", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"250", ",", "125"}], "}"}]}], ",", 
          RowBox[{"AspectRatio", "\[Rule]", 
           RowBox[{"1", "/", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"SqrtWNRVPlotSmall", "=", "\[IndentingNewLine]", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{"WithS", ",", "AllREs"}], "]"}], ",", 
          RowBox[{"Joined", "\[Rule]", "True"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"250", ",", "125"}], "}"}]}], ",", 
          RowBox[{"AspectRatio", "\[Rule]", 
           RowBox[{"1", "/", "2"}]}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"Thickness", "[", "0.012", "]"}]}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"\"\<x\>\"", ",", "\"\<Sqrt(WNRV)\>\""}], "}"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"SqrtWNRVPlot", "=", "\[IndentingNewLine]", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{"WithS", ",", "AllREs"}], "]"}], ",", 
          RowBox[{"Joined", "\[Rule]", "True"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"500", ",", "125"}], "}"}]}], ",", 
          RowBox[{"AspectRatio", "\[Rule]", "0.21"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"Thickness", "[", "0.006", "]"}]}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"\"\<x\>\"", ",", "\"\<Sqrt(WNRV)\>\""}], "}"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Large", " ", "estimates"}], ",", " ", 
         RowBox[{"smaller", " ", "WNRV", " ", "and", " ", 
          RowBox[{"std", ".", " ", "devs", "."}]}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"CombinedPlot", "=", 
        RowBox[{"Legended", "[", 
         RowBox[{
          RowBox[{"Column", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"EstimatesPlot", ",", 
              RowBox[{"Row", "[", 
               RowBox[{"{", 
                RowBox[{"SqrtWNRVPlotSmall", ",", "StdDevsPlotSmall"}], "}"}],
                "]"}]}], "}"}], ",", "Center"}], "]"}], ",", 
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"LineLegend", "[", 
             RowBox[{"Colours", ",", "EstNames", ",", 
              RowBox[{"LegendLayout", "->", "\"\<Row\>\""}]}], "]"}], ",", 
            "Below"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"TestName", "<>", "\"\<.pdf\>\""}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "CombinedPlot", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"TestName", "<>", "\"\<.pdf\>\""}], ",", "CombinedPlot"}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PrintAndPlotResults", "[", 
     RowBox[{
     "Copula_", ",", "Margs_", ",", "R_", ",", "ss_", ",", "PushoutEsts_", 
      ",", "PushoutVars_", ",", "PushoutTime_", ",", "PushoutISEsts_", ",", 
      "PushoutISVars_", ",", "PushoutISTime_", ",", "SingleCondEsts_", ",", 
      "SingleCondVars_", ",", "SingleCondTime_", ",", "CondEsts_", ",", 
      "CondVars_", ",", "CondTime_", ",", "AKEsts_", ",", "AKVars_", ",", 
      "AKTime_", ",", " ", "KDEEsts_", ",", "KDETime_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "TestName", ",", "WithS", ",", "Colours", ",", "EstNames", ",", 
        "AllEsts", ",", "AllStdDevs", ",", "AllTimes", ",", "AllREs", ",", 
        "EstimatesPlotSmall", ",", "StdDevsPlotSmall", ",", "SqrtWNRVPlot", 
        ",", "SqrtWNRVPlotSmall", ",", "CombinedPlot"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"TestName", "=", " ", 
        RowBox[{"GetTestName", "[", 
         RowBox[{"Copula", ",", "Margs"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Setup", " ", "everything", " ", "with", " ", "both", " ", 
         "conditional", " ", 
         RowBox[{"MC", "'"}], 
         RowBox[{"s", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"EstNames", "=", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Sensitivity\>\"", ",", "\"\<Single CondMC\>\"", ",", 
          "\"\<CondMC\>\"", ",", " ", "\"\<AK\>\""}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AllEsts", "=", 
        RowBox[{"{", 
         RowBox[{
         "PushoutEsts", ",", "SingleCondEsts", ",", "CondEsts", ",", 
          "AKEsts"}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllStdDevs", "=", 
        RowBox[{"Sqrt", "@", 
         RowBox[{"{", 
          RowBox[{
          "PushoutVars", ",", "SingleCondVars", ",", "CondVars", ",", 
           "AKVars"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllTimes", "=", 
        RowBox[{"{", 
         RowBox[{
         "PushoutTime", ",", "SingleCondTime", ",", "CondTime", ",", 
          "AKTime"}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllREs", "=", 
        RowBox[{"Quiet", "[", 
         RowBox[{
          RowBox[{"Sqrt", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"PushoutTime", " ", "*", " ", 
               FractionBox[
                RowBox[{"PushoutVars", "/", "R"}], 
                SuperscriptBox["PushoutEsts", "2"]]}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"SingleCondTime", "*", " ", 
               FractionBox[
                RowBox[{"SingleCondVars", "/", "R"}], 
                SuperscriptBox["SingleCondEsts", "2"]]}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"CondTime", "*", " ", 
               FractionBox[
                RowBox[{"CondVars", "/", "R"}], 
                SuperscriptBox["CondEsts", "2"]]}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"AKTime", " ", "*", " ", 
               FractionBox[
                RowBox[{"AKVars", "/", "R"}], 
                SuperscriptBox["AKEsts", "2"]]}], ")"}]}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Power", "::", "infy"}], ",", 
            RowBox[{"Infinity", "::", "indet"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PrintResults", "[", 
        RowBox[{
        "EstNames", ",", "AllEsts", ",", "AllStdDevs", ",", "AllTimes", ",", 
         "AllREs"}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PlotResults", "[", 
        RowBox[{
         RowBox[{"TestName", "<>", "\"\<_both_cond\>\""}], ",", "ss", ",", 
         "EstNames", ",", "AllEsts", ",", "AllStdDevs", ",", "AllTimes", ",", 
         "AllREs"}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Use", " ", "just", " ", "the", " ", "averaged", " ", 
         RowBox[{"CondMC", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"EstNames", "=", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Sensitivity\>\"", ",", "\"\<CondMC\>\"", ",", " ", 
          "\"\<AK\>\""}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllEsts", "=", 
        RowBox[{"{", 
         RowBox[{"PushoutEsts", ",", "CondEsts", ",", "AKEsts"}], "}"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"AllStdDevs", "=", 
        RowBox[{"Sqrt", "@", 
         RowBox[{"{", 
          RowBox[{"PushoutVars", ",", "CondVars", ",", "AKVars"}], "}"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"AllTimes", "=", 
        RowBox[{"{", 
         RowBox[{"PushoutTime", ",", "CondTime", ",", "AKTime"}], "}"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"AllREs", "=", 
        RowBox[{"Quiet", "[", 
         RowBox[{
          RowBox[{"Sqrt", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"PushoutTime", " ", "*", " ", 
               FractionBox[
                RowBox[{"PushoutVars", "/", "R"}], 
                SuperscriptBox["PushoutEsts", "2"]]}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"CondTime", " ", "*", " ", 
               FractionBox[
                RowBox[{"CondVars", "/", "R"}], 
                SuperscriptBox["CondEsts", "2"]]}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"AKTime", " ", "*", " ", 
               FractionBox[
                RowBox[{"AKVars", "/", "R"}], 
                SuperscriptBox["AKEsts", "2"]]}], ")"}]}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Power", "::", "infy"}], ",", 
            RowBox[{"Infinity", "::", "indet"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PlotResults", "[", 
        RowBox[{
        "TestName", ",", "ss", ",", "EstNames", ",", "AllEsts", ",", 
         "AllStdDevs", ",", "AllTimes", ",", "AllREs"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Use", " ", "just", " ", "the", " ", "single", " ", 
         RowBox[{"CondMC", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"EstNames", "=", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Sensitivity\>\"", ",", "\"\<Single CondMC\>\"", ",", " ", 
          "\"\<AK\>\""}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllEsts", "=", 
        RowBox[{"{", 
         RowBox[{"PushoutEsts", ",", "SingleCondEsts", ",", "AKEsts"}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllStdDevs", "=", 
        RowBox[{"Sqrt", "@", 
         RowBox[{"{", 
          RowBox[{"PushoutVars", ",", "SingleCondVars", ",", "AKVars"}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllTimes", "=", 
        RowBox[{"{", 
         RowBox[{"PushoutTime", ",", "SingleCondTime", ",", "AKTime"}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AllREs", "=", 
        RowBox[{"Quiet", "[", 
         RowBox[{
          RowBox[{"Sqrt", "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"PushoutTime", " ", "*", " ", 
               FractionBox[
                RowBox[{"PushoutVars", "/", "R"}], 
                SuperscriptBox["PushoutEsts", "2"]]}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"SingleCondTime", "*", " ", 
               FractionBox[
                RowBox[{"SingleCondVars", "/", "R"}], 
                SuperscriptBox["SingleCondEsts", "2"]]}], ")"}], ",", 
             RowBox[{"(", 
              RowBox[{"AKTime", " ", "*", " ", 
               FractionBox[
                RowBox[{"AKVars", "/", "R"}], 
                SuperscriptBox["AKEsts", "2"]]}], ")"}]}], "}"}]}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Power", "::", "infy"}], ",", 
            RowBox[{"Infinity", "::", "indet"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PlotResults", "[", 
        RowBox[{
         RowBox[{"TestName", "<>", "\"\<_single_cond\>\""}], ",", "ss", ",", 
         "EstNames", ",", "AllEsts", ",", "AllStdDevs", ",", "AllTimes", ",", 
         "AllREs"}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"TestName", ",", "\"\< done\>\""}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RunTest", "[", 
     RowBox[{"Test_", ",", "R_", ",", "NumPoints_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "Copula", ",", "Margs", ",", "ss", ",", "quant", ",", "SimulationTime",
         ",", "RVs", ",", "Zs", ",", "SingleCondEsts", ",", "SingleCondVars", 
        ",", "SingleCondTime", ",", "CondEsts", ",", "CondVars", ",", 
        "CondTime", ",", "AKEsts", ",", "AKVars", ",", "AKTime", ",", 
        "PushoutEsts", ",", "PushoutVars", ",", "PushoutTime", ",", 
        "PushoutISEsts", ",", "PushoutISVars", ",", "PushoutISTime", ",", 
        "KDEEsts", ",", "KDETime"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Marg", ",", "n", ",", "sRange"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Extract", " ", "relevant", " ", "copula", " ", "properties", " ", 
           "for", " ", "this", " ", "test", " ", "case"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Copula", ",", "Marg", ",", "n", ",", "sRange"}], "}"}], 
            "=", "Test"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Copula", ",", "Marg", ",", "n"}], "}"}], "=", "Test"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "If", " ", "given", " ", "a", " ", "list", " ", "of", " ", 
             "marginals", " ", "use", " ", "them"}], ",", " ", 
            RowBox[{
            "otherwise", " ", "take", " ", "marginals", " ", "to", " ", "be", 
             " ", "identically", " ", "distributed"}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Margs", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"ListQ", "[", "Marg", "]"}], ",", " ", "Marg", ",", " ", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"Marg", ",", "n"}], "]"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"ss", "=", " ", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{
              RowBox[{"sRange", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"sRange", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"sRange", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"sRange", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", 
               "NumPoints"}]}], "]"}], "//", 
            RowBox[{
             RowBox[{"DeleteCases", "[", 
              RowBox[{"#", ",", "0"}], "]"}], "&"}]}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Starting test: \>\"", ",", 
         RowBox[{"GetTestName", "[", 
          RowBox[{"Copula", ",", "Margs"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"SeedRandom", "[", "1", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<Time to simulate (trial run to get 95% quantile): \>\"", ",", 
         RowBox[{"First", "@", 
          RowBox[{"Timing", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"RVs", ",", "Zs"}], "}"}], "=", 
             RowBox[{"SimulateXs", "[", 
              RowBox[{"Copula", ",", "Margs", ",", "R"}], "]"}]}], ";"}], 
           "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Update", " ", "the", " ", "s", " ", "values", " ", "chosen", " ", 
         "to", " ", "go", " ", "up", " ", "to", " ", "the", " ", "95", "%", 
         " ", "empirical", " ", "quantile", " ", "of", " ", "the", " ", 
         RowBox[{"sums", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"quant", "=", 
        RowBox[{"Quantile", "[", 
         RowBox[{
          RowBox[{"Total", "/@", "RVs"}], ",", "0.95"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ss", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "quant", ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"quant", "-", "0"}], ")"}], "/", "NumPoints"}]}], "]"}],
           "//", 
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{"#", ",", "0"}], "]"}], "&"}]}], "//", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{"#", ",", "0.0"}], "]"}], "&"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<ss = \>\"", ",", "ss"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"SeedRandom", "[", "1337", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Time to simulate (new seed): \>\"", ",", 
         RowBox[{"SimulationTime", "=", " ", 
          RowBox[{"First", "@", 
           RowBox[{"Timing", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"RVs", ",", "Zs"}], "}"}], "=", 
              RowBox[{"SimulateXs", "[", 
               RowBox[{"Copula", ",", "Margs", ",", "R"}], "]"}]}], ";"}], 
            "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Time to do CondMC + CondMO + AK: \>\"", ",", " ", 
         RowBox[{"First", "@", 
          RowBox[{"Timing", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "SingleCondEsts", ",", "SingleCondVars", ",", "SingleCondTime", 
              ",", "CondEsts", ",", "CondVars", ",", "CondTime", ",", 
              "AKEsts", ",", "AKVars", ",", "AKTime"}], "}"}], "=", 
            RowBox[{"CondMCandAKEstimators", "[", 
             RowBox[{
             "Copula", ",", "Margs", ",", "R", ",", "ss", ",", "RVs", ",", 
              "Zs"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Single Cond MC time: \>\"", ",", "SingleCondTime"}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Cond MC time: \>\"", ",", " ", "CondTime"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<AK time: \>\"", ",", "AKTime"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Push-out took \>\"", ",", 
         RowBox[{"PushoutTime", "=", 
          RowBox[{"First", "@", 
           RowBox[{"Timing", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"PushoutEsts", ",", "PushoutVars"}], "}"}], "=", 
              RowBox[{"PushoutEstimator", "[", 
               RowBox[{
               "Copula", ",", "Margs", ",", "R", ",", "ss", ",", "RVs"}], 
               "]"}]}], ";"}], "\[IndentingNewLine]", "]"}]}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"IsIndCopula", "[", "Copula", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Push-out with IS took \>\"", ",", 
            RowBox[{"PushoutISTime", "=", 
             RowBox[{"First", "@", 
              RowBox[{"Timing", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"PushoutISEsts", ",", "PushoutISVars"}], "}"}], "=", 
                 RowBox[{"PushoutISEstimator", "[", 
                  RowBox[{"Copula", ",", "Margs", ",", "R", ",", "ss"}], 
                  "]"}]}], ";"}], "\[IndentingNewLine]", "]"}]}]}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<KDE took: \>\"", ",", 
           RowBox[{"KDETime", "=", 
            RowBox[{"First", "@", 
             RowBox[{"Timing", "[", "\[IndentingNewLine]", 
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"KDEDist", ",", 
                  RowBox[{"Sums", "=", 
                   RowBox[{"Total", "/@", "RVs"}]}]}], "}"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"KDEDist", "=", 
                  RowBox[{"KernelMixtureDistribution", "[", "Sums", "]"}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"KDEEsts", "=", 
                  RowBox[{
                   RowBox[{"PDF", "[", 
                    RowBox[{"KDEDist", ",", "ss"}], "]"}], "+", 
                   RowBox[{"PDF", "[", 
                    RowBox[{"KDEDist", ",", 
                    RowBox[{"-", "ss"}]}], "]"}]}]}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], "]"}]}]}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"PrintAndPlotResults", "[", 
        RowBox[{
        "Copula", ",", "Margs", ",", "R", ",", "ss", ",", "PushoutEsts", ",", 
         "PushoutVars", ",", 
         RowBox[{"PushoutTime", "+", "SimulationTime"}], ",", "PushoutISEsts",
          ",", "PushoutISVars", ",", "PushoutISTime", ",", "SingleCondEsts", 
         ",", "SingleCondVars", ",", 
         RowBox[{"SingleCondTime", "+", "SimulationTime"}], ",", "CondEsts", 
         ",", "CondVars", ",", 
         RowBox[{"CondTime", "+", "SimulationTime"}], ",", "AKEsts", ",", 
         "AKVars", ",", 
         RowBox[{"AKTime", "+", "SimulationTime"}], ",", " ", "KDEEsts", ",", 
         RowBox[{"KDETime", "+", "SimulationTime"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tests", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<Clayton\>\"", ",", 
          RowBox[{"1", "/", "2"}]}], "}"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"GammaDistribution", "[", 
           RowBox[{
            RowBox[{"i", "+", "1"}], ",", 
            FractionBox["2", 
             RowBox[{"i", "+", "1"}]]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "5"}], "}"}]}], "]"}], ",", "5"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<Clayton\>\"", ",", 
          RowBox[{"1", "/", "5"}]}], "}"}], ",", 
        RowBox[{"WeibullDistribution", "[", 
         RowBox[{
          RowBox[{"3", "/", "10"}], ",", "1"}], "]"}], ",", "10"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<GumbelHougaard\>\"", ",", "5"}], "}"}], ",", 
        RowBox[{"ExponentialDistribution", "[", "1", "]"}], ",", "15"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<Frank\>\"", ",", " ", 
          RowBox[{"1", "/", "1000"}]}], "}"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"LogNormalDistribution", "[", 
           RowBox[{
            RowBox[{"i", "-", "10"}], ",", 
            SqrtBox["i"]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "10"}], "}"}]}], "]"}], ",", "10"}], "}"}]}], 
     "\[IndentingNewLine]", "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"R", "=", 
    SuperscriptBox["10", "5"]}], ";", 
   RowBox[{"NumPoints", "=", "50"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"RunTest", "[", 
     RowBox[{"test", ",", "R", ",", "NumPoints"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"test", ",", "Tests"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7201259498415003`*^9, 3.720126145031769*^9}, {
   3.7201271380462427`*^9, 3.720127139206635*^9}, 3.720198163612819*^9, 
   3.7202061593205357`*^9, 3.7202156455283265`*^9, {3.720491672800846*^9, 
   3.720491691917166*^9}, {3.7204917243364897`*^9, 3.720491772440013*^9}, {
   3.7204918055147266`*^9, 3.7204918313673844`*^9}, {3.72049189894461*^9, 
   3.7204919191316752`*^9}, {3.7204919534441147`*^9, 3.7204919858104935`*^9}, 
   3.720492068800249*^9, {3.72049220212245*^9, 3.720492346908039*^9}, {
   3.7204924423483105`*^9, 3.7204924431824574`*^9}, {3.720492479128731*^9, 
   3.720492532558169*^9}, {3.7204925734139767`*^9, 3.720492575412912*^9}, {
   3.720492606446915*^9, 3.7204926124831057`*^9}, {3.720492693380233*^9, 
   3.720492701142302*^9}, {3.7204927485159874`*^9, 3.720492752801355*^9}, {
   3.720492820041812*^9, 3.720492843903942*^9}, {3.7204928838279247`*^9, 
   3.720492926003873*^9}, {3.720493026333272*^9, 3.7204930463167243`*^9}, {
   3.7204931347111297`*^9, 3.720493186658331*^9}, {3.7204932918735495`*^9, 
   3.7204933061230445`*^9}, {3.7204933812958956`*^9, 3.720493440538459*^9}, {
   3.7204934883833103`*^9, 3.720493495118434*^9}, 3.7204937308335576`*^9, {
   3.7204938899109287`*^9, 3.720493928081758*^9}, {3.720494566603955*^9, 
   3.7204945812213497`*^9}, 3.720494741502356*^9, {3.7204950877659087`*^9, 
   3.720495104125247*^9}, {3.720495186566225*^9, 3.720495250414268*^9}, {
   3.720495369499463*^9, 3.7204954201215005`*^9}, 3.720495459571876*^9, 
   3.7205042853825293`*^9, {3.7208199731659865`*^9, 3.720820005256028*^9}, {
   3.7208209532763405`*^9, 3.7208210349934983`*^9}, {3.720826451692055*^9, 
   3.720826471878925*^9}, {3.72082667994662*^9, 3.7208266965787325`*^9}, {
   3.7208269607793803`*^9, 3.720826962303753*^9}, {3.720827015236422*^9, 
   3.7208270193837643`*^9}, 3.720827053573597*^9, {3.720827112901428*^9, 
   3.720827338739684*^9}, {3.720827390948497*^9, 3.7208274060768876`*^9}, {
   3.7208274751853447`*^9, 3.720827512015213*^9}, {3.7208276519230013`*^9, 
   3.7208277018973956`*^9}, {3.7208277350714593`*^9, 3.72082773699953*^9}, {
   3.720827919270683*^9, 3.7208279691302605`*^9}, {3.7208281138521767`*^9, 
   3.720828283634594*^9}, {3.720828322773494*^9, 3.720828478698598*^9}, {
   3.7208285212884693`*^9, 3.7208285241137342`*^9}, {3.7208286293142753`*^9, 
   3.720828681689494*^9}, {3.720828773915881*^9, 3.720828796964814*^9}, {
   3.720828829026057*^9, 3.7208288500259705`*^9}, {3.7208296014730935`*^9, 
   3.72082960192297*^9}, {3.720830303873045*^9, 3.720830319732712*^9}, 
   3.720830399090743*^9, {3.7208304326218615`*^9, 3.720830432888538*^9}, 
   3.720830491878066*^9, {3.720831257879526*^9, 3.720831258272428*^9}, {
   3.7208313370607567`*^9, 3.7208313780882607`*^9}, 3.720831412985833*^9, {
   3.7208320839266214`*^9, 3.7208321120556746`*^9}, {3.7208322188088923`*^9, 
   3.720832239743015*^9}, 3.720832323813773*^9, {3.7208325301148233`*^9, 
   3.7208325478547554`*^9}, {3.7208326028749957`*^9, 
   3.7208329246664667`*^9}, {3.720832960273452*^9, 3.720832968147951*^9}, {
   3.720833045972583*^9, 3.7208330590770106`*^9}, {3.72083309428372*^9, 
   3.7208330980669994`*^9}, {3.720833281594101*^9, 3.7208332850518227`*^9}, {
   3.7208347568031282`*^9, 3.720834758081313*^9}, {3.7208361487987866`*^9, 
   3.72083619627172*^9}, {3.72083623419186*^9, 3.7208362402394466`*^9}, {
   3.720836362580803*^9, 3.720836383475421*^9}, 3.7208367624754343`*^9, {
   3.7208371533417597`*^9, 3.720837164350934*^9}, 3.7208372000170984`*^9, {
   3.720845612209841*^9, 3.7208461293683653`*^9}, {3.7208461766011877`*^9, 
   3.7208461902344365`*^9}, {3.7208462680768023`*^9, 3.720846277060253*^9}, {
   3.7208464249820976`*^9, 3.7208464257493143`*^9}, {3.7208464772113132`*^9, 
   3.720846482924655*^9}, 3.720846543753929*^9, 3.7208481233787737`*^9, 
   3.7208862331593447`*^9, {3.7209023907508745`*^9, 3.7209024716222706`*^9}, {
   3.720902572428473*^9, 3.72090268160585*^9}, {3.720902714529727*^9, 
   3.720902985920893*^9}, {3.72090304399269*^9, 3.720903049533675*^9}, {
   3.720912784648999*^9, 3.7209128017388163`*^9}, {3.7209237996488695`*^9, 
   3.7209239301451826`*^9}, {3.7209239609183297`*^9, 
   3.7209240950626564`*^9}, {3.7209241693958693`*^9, 3.720924633571661*^9}, {
   3.72092474958473*^9, 3.7209248636552973`*^9}, {3.720926228407049*^9, 
   3.720926266198084*^9}, {3.7209263108462977`*^9, 3.720926459686636*^9}, {
   3.7209265361022673`*^9, 3.7209265573255816`*^9}, {3.7209266039826097`*^9, 
   3.7209266248335304`*^9}, {3.720926803341508*^9, 3.7209269036819677`*^9}, 
   3.720926934075836*^9, {3.720927077850713*^9, 3.7209270810073304`*^9}, 
   3.720947232247261*^9, {3.7209473803577433`*^9, 3.7209474174782896`*^9}, {
   3.7209909876297717`*^9, 3.720990989198064*^9}, {3.720991042068881*^9, 
   3.7209911692825904`*^9}, {3.720991206960436*^9, 3.7209912075095987`*^9}, 
   3.720991267627341*^9, {3.7355224527504606`*^9, 3.7355224709562683`*^9}, {
   3.7355225467626333`*^9, 3.7355228152924733`*^9}, 3.7355230359413586`*^9, {
   3.7355232055938945`*^9, 3.7355235567318516`*^9}, {3.735523650190715*^9, 
   3.7355236593698163`*^9}, {3.7355238424264297`*^9, 
   3.7355238735011196`*^9}, {3.735524100430331*^9, 3.735524100627839*^9}, {
   3.7355241704382305`*^9, 3.7355241759374857`*^9}, {3.7355242210056334`*^9, 
   3.7355242214508605`*^9}, 3.7355244171459455`*^9, {3.7355245441781874`*^9, 
   3.7355245466785097`*^9}, {3.735524965701804*^9, 3.7355249662463627`*^9}, {
   3.7355251947902884`*^9, 3.7355252480221496`*^9}, {3.7355256529619226`*^9, 
   3.735525655069969*^9}, {3.7355264184644036`*^9, 3.7355264574777813`*^9}, 
   3.7355265944948483`*^9, {3.7355266708126593`*^9, 3.735526727882229*^9}, {
   3.735526781827777*^9, 3.7355267826305237`*^9}, {3.7355269284591427`*^9, 
   3.7355269296418085`*^9}, {3.735526988016882*^9, 3.735526989448409*^9}, {
   3.7355270898566318`*^9, 3.735527090590082*^9}, {3.735527354526326*^9, 
   3.7355273657243505`*^9}, {3.7355274050572205`*^9, 3.7355274052644033`*^9}, 
   3.7355275244809923`*^9, 3.735527708222492*^9, {3.7355278241170983`*^9, 
   3.7355278242763295`*^9}, 3.7355278937147083`*^9, 3.7355281391364765`*^9, 
   3.735528278449671*^9, {3.7355286061226463`*^9, 3.735528616987314*^9}, {
   3.7355479923063126`*^9, 3.735548015622349*^9}, 3.735548423902769*^9, {
   3.735549190437148*^9, 3.7355491935615416`*^9}, {3.7355492739286995`*^9, 
   3.73554927719238*^9}, {3.7356951025430126`*^9, 3.7356951081349297`*^9}, {
   3.735695154944251*^9, 3.735695175103817*^9}, {3.735695259420562*^9, 
   3.7356953647263813`*^9}, {3.735695410205412*^9, 3.7356954378379145`*^9}, {
   3.7356955868689938`*^9, 3.735695624990319*^9}, {3.735695660234929*^9, 
   3.7356956862347326`*^9}, {3.735695854953726*^9, 3.7356958594797516`*^9}, {
   3.7356959884951954`*^9, 3.7356960085575113`*^9}, {3.735696127998545*^9, 
   3.7356961796146665`*^9}, 3.735696239012494*^9, 3.736465081713666*^9, {
   3.7364651695360365`*^9, 3.7364652033926373`*^9}, {3.736465732481716*^9, 
   3.736465733089718*^9}, {3.7364658884384947`*^9, 3.7364658932583437`*^9}, {
   3.736465974682615*^9, 3.736465987657197*^9}, {3.7364660222317142`*^9, 
   3.7364660681927648`*^9}, {3.73646609836036*^9, 3.736466147461771*^9}, {
   3.7364662632232285`*^9, 3.7364663329048367`*^9}, {3.736466396122496*^9, 
   3.736466470820161*^9}, {3.7364665972784696`*^9, 3.736466618423197*^9}, {
   3.736466664908097*^9, 3.736466677682887*^9}, {3.73646675806326*^9, 
   3.7364671337755647`*^9}, {3.7364671924095163`*^9, 
   3.7364672213284874`*^9}, {3.73646735211779*^9, 3.736467369152238*^9}, {
   3.7364674498102703`*^9, 3.736467484859371*^9}, {3.736467515991231*^9, 
   3.736467622937358*^9}, 3.736467679834337*^9, {3.736467818904248*^9, 
   3.736467819531595*^9}, {3.7364679410761623`*^9, 3.7364679627437754`*^9}, {
   3.736468166159707*^9, 3.736468169617123*^9}, {3.7364682331807737`*^9, 
   3.736468242323005*^9}, 3.7364683913008394`*^9, {3.7364686083143234`*^9, 
   3.7364686223040547`*^9}, {3.736468691695197*^9, 3.7364687426790323`*^9}, {
   3.736468960390616*^9, 3.736468965783583*^9}, {3.7364690296320233`*^9, 
   3.7364690605458736`*^9}, {3.736469105742561*^9, 3.736469114333982*^9}, 
   3.736469147581415*^9, {3.736469185334276*^9, 3.7364691859346447`*^9}, {
   3.736469238468583*^9, 3.736469242496525*^9}, {3.736469715721209*^9, 
   3.7364697520752482`*^9}, {3.7364698994471216`*^9, 3.736469911820961*^9}, {
   3.7364699961552687`*^9, 3.7364700039534836`*^9}, {3.736470276632352*^9, 
   3.736470335425581*^9}, {3.736470474299409*^9, 3.7364704754151783`*^9}, {
   3.736471494466239*^9, 3.73647160726022*^9}, {3.736471646310959*^9, 
   3.736471652536968*^9}, {3.7364717059613695`*^9, 3.736471709310921*^9}, {
   3.736471778598796*^9, 3.736471780273303*^9}, {3.7376877542172875`*^9, 
   3.7376878325222783`*^9}, {3.737687962549444*^9, 3.737687999518796*^9}, {
   3.737688067453809*^9, 3.737688125692567*^9}, {3.737688176903448*^9, 
   3.737688177492144*^9}, {3.7376883523243775`*^9, 3.7376884070512047`*^9}, {
   3.7377748418823776`*^9, 3.737774898077179*^9}, {3.737774966787692*^9, 
   3.7377749688199415`*^9}, {3.7377753346709337`*^9, 3.737775335459849*^9}, 
   3.73777540080256*^9, 3.737775483878371*^9, {3.737776628109818*^9, 
   3.7377768404979744`*^9}, {3.737776877946345*^9, 3.7377768995376825`*^9}, {
   3.7377769620943856`*^9, 3.737777016150973*^9}, {3.7377770813054175`*^9, 
   3.737777121846614*^9}, {3.737777186759939*^9, 3.7377771873929462`*^9}, {
   3.7377772265828238`*^9, 3.7377772421147676`*^9}, {3.7377773100333586`*^9, 
   3.7377773105856857`*^9}, {3.737777389743911*^9, 3.7377773912404785`*^9}, {
   3.7377774553334274`*^9, 3.7377774614506903`*^9}, {3.737785796898726*^9, 
   3.7377858255141735`*^9}, {3.737785925992488*^9, 3.737785960597793*^9}, {
   3.737786075358152*^9, 3.737786079669899*^9}, {3.737786153032607*^9, 
   3.7377861665178137`*^9}, 3.737786259916898*^9, {3.737786293587715*^9, 
   3.737786298614358*^9}, {3.7377863878436394`*^9, 3.737786448174553*^9}, {
   3.7377865035031853`*^9, 3.7377865091593523`*^9}, {3.737786622920212*^9, 
   3.737786646300157*^9}, {3.737786782573988*^9, 3.737786782883328*^9}, {
   3.7378343556803417`*^9, 3.7378344189500046`*^9}, {3.7378344990061026`*^9, 
   3.7378345136252174`*^9}, {3.7378345484520884`*^9, 
   3.7378346157651734`*^9}, {3.73783468874341*^9, 3.7378348178897486`*^9}, {
   3.737834872283922*^9, 3.737834882401759*^9}, {3.737834912832247*^9, 
   3.737834980114907*^9}, {3.7378352948153515`*^9, 3.7378353695715775`*^9}, {
   3.7378354029214525`*^9, 3.7378354106897817`*^9}, {3.737835531323316*^9, 
   3.737835572086027*^9}, {3.737835656886726*^9, 3.737835676535899*^9}, {
   3.7378357435757923`*^9, 3.737835744367697*^9}, {3.7378360047479353`*^9, 
   3.737836046941986*^9}, {3.7378360984875116`*^9, 3.737836149439643*^9}, {
   3.737836268970766*^9, 3.7378363558546762`*^9}, {3.7378363882166185`*^9, 
   3.7378365720451508`*^9}, {3.7378366841271544`*^9, 3.737836704866768*^9}, {
   3.7378367670161057`*^9, 3.7378368220419836`*^9}, {3.7378376342633896`*^9, 
   3.737837634949551*^9}, {3.7378377284486723`*^9, 3.737837784994972*^9}, {
   3.73783785135338*^9, 3.737837898029707*^9}, {3.7378381133731365`*^9, 
   3.737838146256139*^9}, {3.7378382463928537`*^9, 3.737838265854793*^9}, 
   3.7378383076430073`*^9, {3.7378492236824493`*^9, 3.7378492391381035`*^9}, {
   3.737849291477303*^9, 3.737849339986676*^9}, {3.7378493953172894`*^9, 
   3.737849397607151*^9}, {3.7382672279703856`*^9, 3.738267320460397*^9}, {
   3.738267358800538*^9, 3.7382674137805004`*^9}, {3.7382674438404207`*^9, 
   3.738267502270689*^9}, {3.738267543489504*^9, 3.7382678422205095`*^9}, {
   3.738267873030636*^9, 3.738267913440792*^9}, {3.7382682986807804`*^9, 
   3.738268314570777*^9}, {3.7382686676119356`*^9, 3.7382687304703417`*^9}, {
   3.7382689123099747`*^9, 3.7382689414207153`*^9}, {3.7382690965945644`*^9, 
   3.7382691940704308`*^9}, {3.7382722403732758`*^9, 
   3.7382722648372583`*^9}, {3.73827238692939*^9, 3.738272387400306*^9}, 
   3.7382748619162197`*^9, {3.738274937210861*^9, 3.738274952209792*^9}, {
   3.738280038726314*^9, 3.7382800423655148`*^9}, 3.7382802799999905`*^9, {
   3.738281312600321*^9, 3.738281549330204*^9}, {3.73828263217379*^9, 
   3.7382828019708614`*^9}, {3.738283056853169*^9, 3.7382831387749357`*^9}, {
   3.7382832315723124`*^9, 3.7382832330250816`*^9}, {3.7382837605425572`*^9, 
   3.738283781571336*^9}, 3.7382845991809263`*^9, {3.7382864626411667`*^9, 
   3.7382864658591523`*^9}, {3.738374984137347*^9, 3.7383751400752316`*^9}, {
   3.738375482129362*^9, 3.7383755133533335`*^9}, {3.7383755718851833`*^9, 
   3.738375580015585*^9}, {3.7385316505838947`*^9, 3.7385316512820587`*^9}, 
   3.738531916704525*^9, {3.738531965064218*^9, 3.7385325293547187`*^9}, {
   3.738532570314886*^9, 3.738532658635874*^9}, {3.7385326937948265`*^9, 
   3.738532923455104*^9}, {3.738532963094965*^9, 3.73853302761497*^9}, {
   3.7385331632247424`*^9, 3.7385331742047234`*^9}, {3.7385332142092915`*^9, 
   3.738533217055002*^9}, {3.738533256994733*^9, 3.738533261484959*^9}, {
   3.7385341314957905`*^9, 3.738534141512944*^9}, 3.738537768944291*^9, {
   3.738875580322919*^9, 3.7388756756931915`*^9}, {3.7388757738599925`*^9, 
   3.7388757784872103`*^9}, {3.7390616380664673`*^9, 3.739061685413534*^9}, {
   3.7390617182140455`*^9, 3.7390618494914865`*^9}, {3.7390619006370597`*^9, 
   3.73906190653106*^9}, {3.7390619865330343`*^9, 3.739061993570794*^9}, 
   3.7390621492980204`*^9, {3.7462553598637495`*^9, 
   3.746255424159247*^9}},ExpressionUUID->"987a6147-5976-403c-a313-\
2c73b13df566"]
},
WindowSize->{1920, 997},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
PrintingCopies->1,
PrintingPageRange->{32000, 32000},
PrintingOptions->{"Magnification"->1.,
"PaperOrientation"->"Portrait",
"PaperSize"->{612, 792}},
Magnification:>1.6 Inherited,
FrontEndVersion->"11.1 for Microsoft Windows (64-bit) (March 13, 2017)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]]}, Visible -> False, 
  FrontEndVersion -> "11.1 for Microsoft Windows (64-bit) (March 13, 2017)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 129524, 2927, 18911, "Input", "ExpressionUUID" -> \
"987a6147-5976-403c-a313-2c73b13df566"]
}
]
*)

